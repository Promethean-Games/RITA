<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Expo Training MVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      /* Neutral defaults – will be overridden by theme at runtime */
      --bg: #f3f4f6;
      --bg-elevated: #ffffff;
      --bg-soft: #e5e7eb;
      --text: #111827;
      --muted: #6b7280;
      --accentA: #f97316;
      --accentB: #facc15;
      --accent: var(--accentA);
      --accent-soft: rgba(249,115,22,0.1);
      --border: #d1d5db;
      --danger: #b91c1c;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-soft: 0 14px 30px rgba(15,23,42,0.12);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body.dark {
      --bg: #020617;
      --bg-elevated: #0b1120;
      --bg-soft: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: #1f2937;
      --shadow-soft: 0 18px 40px rgba(0,0,0,0.65);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      background: var(--bg);
      font-family: var(--font-main);
      color: var(--text);
    }

    .app-shell {
      width: 100%;
      max-width: 480px;
      min-height: 100vh;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      position: relative;
    }

    header {
      flex-shrink: 0;
      border-bottom: 1px solid var(--border);
      background: var(--bg-elevated);
      box-shadow: 0 1px 0 rgba(15,23,42,0.03);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .header-inner {
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .header-titles {
      display: flex;
      flex-direction: column;
    }

    .header-title {
      font-size: 1rem;
      font-weight: 600;
    }

    .header-sub {
      font-size: 0.75rem;
      color: var(--muted);
      cursor: pointer;
    }

    .icon-btn {
      border: none;
      background: transparent;
      padding: 0.3rem;
      border-radius: 999px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--muted);
    }

    .icon-btn:hover {
      background: var(--bg-soft);
      color: var(--text);
    }

    .icon {
      width: 18px;
      height: 18px;
      display: inline-block;
    }

    main {
      flex: 1;
      padding: 0.75rem 1rem 0.8rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .card {
      background: var(--bg-elevated);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      padding: 0.85rem 0.9rem;
    }

    .card + .card {
      margin-top: 0.25rem;
    }

    h2 {
      margin: 0 0 0.4rem;
      font-size: 1rem;
    }

    h3 {
      margin: 0 0 0.3rem;
      font-size: 0.95rem;
    }

    p {
      margin: 0;
      font-size: 0.85rem;
      line-height: 1.4;
    }

    .muted {
      color: var(--muted);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 0.1rem 0.5rem;
      border-radius: 999px;
      font-size: 0.7rem;
      background: var(--accent-soft);
      color: var(--accentA);
      font-weight: 500;
      margin-bottom: 0.35rem;
    }

    .progress-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .progress-label {
      font-size: 0.85rem;
      font-weight: 500;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: var(--bg-soft);
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accentA), var(--accentB));
      width: 0%;
      transition: width 0.2s ease-out;
    }

    .alert {
      border-radius: var(--radius-md);
      padding: 0.5rem 0.6rem;
      border: 1px solid var(--border);
      background: var(--bg-soft);
      font-size: 0.82rem;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 0.5rem;
      margin-top: 0.25rem;
    }

    .alert.complete {
      border-color: rgba(34,197,94,0.4);
      background: rgba(22,163,74,0.05);
    }

    .alert strong {
      display: block;
      margin-bottom: 0.15rem;
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      margin-top: 0.3rem;
    }

    .list-item {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      padding: 0.55rem 0.65rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      background: var(--bg-elevated);
      cursor: pointer;
      font-size: 0.86rem;
      transition: background 0.15s ease, border-color 0.15s ease;
    }

    .list-item span.label {
      flex: 1;
    }

    .list-item span.meta {
      font-size: 0.75rem;
      color: var(--muted);
    }

    /* Required modules now fully theme-driven */
    .list-item.status-required {
      background: var(--accent-soft);
      border-color: var(--accentA);
    }

    body.dark .list-item.status-required {
      background: var(--accent-soft);
      border-color: var(--accentA);
    }

    .list-item.status-complete {
      background: rgba(34,197,94,0.08);
      border-color: rgba(34,197,94,0.45);
    }

    body.dark .list-item.status-complete {
      background: rgba(34,197,94,0.18);
      border-color: rgba(34,197,94,0.7);
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 0.55rem 0.9rem;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
      margin-top: 0.4rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accentA), var(--accentB));
      color: #111827;
      font-weight: 600;
      width: 100%;
      transition: background 0.15s ease, opacity 0.15s ease;
    }

    .btn-primary[disabled] {
      opacity: 0.6;
      cursor: default;
    }

    .btn-primary.completed {
      background: linear-gradient(135deg, #22c55e, #4ade80);
      color: #022c22;
    }

    .btn-outline {
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
    }

    .divider {
      border-top: 1px solid var(--border);
      margin: 0.5rem 0;
    }

    footer {
      flex-shrink: 0;
      border-top: 1px solid var(--border);
      background: var(--bg-elevated);
      position: sticky;
      bottom: 0;
      z-index: 5;
    }

    .tabbar {
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: 0.4rem 0.2rem 0.55rem;
    }

    .tab-btn {
      flex: 1;
      border: none;
      background: transparent;
      padding: 0.35rem 0;
      font-size: 0.8rem;
      color: var(--muted);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.15rem;
    }

    .tab-btn span.dot {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: transparent;
    }

    .tab-btn.active {
      color: var(--accentA);
      font-weight: 600;
    }

    .tab-btn.active span.dot {
      background: var(--accentA);
    }

    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    .steps {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      margin-top: 0.4rem;
    }

    .step-row {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      font-size: 0.85rem;
    }

    .step-row input {
      margin-top: 0.1rem;
    }

    .hint {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 0.25rem;
    }

    .settings-group {
      margin-top: 0.3rem;
    }

    .settings-item {
      padding: 0.55rem 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
      font-size: 0.85rem;
      cursor: pointer;
    }

    .settings-item.no-click {
      cursor: default;
    }

    .settings-select {
      font-size: 0.8rem;
      padding: 0.2rem 0.4rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--bg-elevated);
      color: var(--text);
    }

    .toggle {
      position: relative;
      width: 34px;
      height: 18px;
      border-radius: 999px;
      background: var(--bg-soft);
      border: 1px solid var(--border);
      cursor: pointer;
    }

    .toggle-thumb {
      position: absolute;
      top: 1px;
      left: 1px;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: var(--muted);
      transition: transform 0.18s ease-out, background 0.18s ease-out;
    }

    .toggle.on {
      background: var(--accent-soft);
      border-color: var(--accentA);
    }

    .toggle.on .toggle-thumb {
      transform: translateX(14px);
      background: var(--accentA);
    }

    .empty-state {
      font-size: 0.85rem;
      color: var(--muted);
      padding: 0.4rem 0;
    }

    .module-image-wrapper {
      width: 100%;
      border-radius: 12px;
      overflow: hidden;
      margin: 0.4rem 0 0.6rem;
      border: 1px solid var(--border);
      background: var(--bg-soft);
    }

    .module-image-wrapper img {
      width: 100%;
      height: auto;
      aspect-ratio: 16 / 9;
      object-fit: cover;
      display: block;
    }

    .module-image-placeholder {
      width: 100%;
      aspect-ratio: 16 / 9;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.78rem;
      color: var(--muted);
      padding: 0.5rem;
      text-align: center;
    }

    .style-guide-note {
      margin-top: 0.4rem;
      font-size: 0.75rem;
      color: var(--muted);
    }

    .preset-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.4rem;
      margin: 0.5rem 0 0.4rem;
    }

    .preset-btn {
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 0.3rem 0.35rem;
      background: var(--bg-elevated);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      font-size: 0.7rem;
      align-items: flex-start;
      transition: border-color 0.16s ease, box-shadow 0.16s ease,
        background 0.16s ease;
    }

    .preset-btn.active {
      border-color: var(--accentA);
      box-shadow: 0 0 0 1px rgba(0,0,0,0.04);
      background: rgba(0,0,0,0.02);
    }

    body.dark .preset-btn.active {
      background: rgba(255,255,255,0.03);
    }

    .preset-name {
      font-weight: 500;
    }

    .preset-swatch {
      display: flex;
      width: 100%;
      border-radius: 999px;
      overflow: hidden;
      height: 14px;
    }

    .preset-swatch span {
      flex: 1;
    }

    .style-row-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-top: 0.4rem;
      font-size: 0.8rem;
    }

    .theme-preview {
      margin-top: 0.6rem;
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 0.55rem;
      background: var(--bg-elevated);
    }

    .theme-preview-swatch {
      border-radius: 10px;
      padding: 0.6rem 0.7rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.7rem;
    }

    .theme-preview-labels {
      font-size: 0.78rem;
    }

    .theme-preview-labels div:first-child {
      font-weight: 600;
      margin-bottom: 0.1rem;
    }

    .theme-preview-button {
      border-radius: 999px;
      padding: 0.4rem 0.9rem;
      border: none;
      font-size: 0.8rem;
      cursor: default;
      white-space: nowrap;
    }

    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 76px;
      background: var(--bg-elevated);
      color: var(--text);
      border-radius: 999px;
      padding: 0.55rem 0.9rem;
      font-size: 0.8rem;
      border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(15,23,42,0.4);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease-out, transform 0.2s ease-out;
      transform-origin: center;
      z-index: 20;
      white-space: nowrap;
      max-width: 90%;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .toast.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(-50%) translateY(-4px);
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="header-inner">
        <div class="header-left">
          <button class="icon-btn" id="backButton" aria-label="Back" style="display:none;">
            <span class="icon">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </span>
          </button>
          <div class="header-titles">
            <div class="header-title" id="headerTitle">Home</div>
            <div class="header-sub" id="headerSub">Fname Lname</div>
          </div>
        </div>
        <button class="icon-btn" id="settingsButton" aria-label="Settings">
          <span class="icon">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 8.9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.6 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 8.9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 8.9 4.6 1.65 1.65 0 0 0 10.41 3.1V3a2 2 0 0 1 4 0v.09A1.65 1.65 0 0 0 15.1 4.6a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 8.9 1.65 1.65 0 0 0 20.9 10.41H21a2 2 0 0 1 0 4h-.09A1.65 1.65 0 0 0 19.4 15z"></path>
            </svg>
          </span>
        </button>
      </div>
    </header>

    <main>
      <!-- HOME VIEW -->
      <section id="view-home" class="view active">
        <div class="card">
          <div class="pill">Dashboard</div>
          <div class="progress-row">
            <div>
              <div class="progress-label" id="progressLabel">
                0 / 0 Modules Completed
              </div>
              <div class="muted" style="font-size:0.78rem;">
                All modules are required.
              </div>
            </div>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div id="homeAlertContainer"></div>
        </div>

        <div class="card">
          <div class="progress-row">
            <h2 style="margin:0;">Modules</h2>
            <button class="btn btn-outline" id="goToModulesBtn">
              View All
            </button>
          </div>
          <div class="list" id="homeModuleList"></div>
        </div>

        <div class="card">
          <h3>Assigned Training</h3>
          <p class="muted" style="font-size:0.8rem;">
            These modules are required for your Expo role.
          </p>
          <div class="list" id="homeAssignedList"></div>
        </div>
      </section>

      <!-- MODULES LIST VIEW -->
      <section id="view-modules" class="view">
        <div class="card">
          <h2>Modules</h2>
          <p class="muted" style="font-size:0.8rem;">
            Tap a module to view steps and mark it complete.
          </p>
          <div class="divider"></div>
          <div id="modulesList"></div>
        </div>
      </section>

      <!-- MODULE DETAIL VIEW -->
      <section id="view-module-detail" class="view">
        <div class="card">
          <div class="pill" id="detailCategoryPill">Prep</div>
          <h2 id="detailTitle">Module Title</h2>
          <p class="muted" id="detailDescription" style="font-size:0.8rem;">
            Description goes here.
          </p>

          <div id="detailImageContainer"></div>

          <div class="steps" id="detailSteps"></div>
          <button class="btn btn-primary" id="completeModuleBtn" disabled>
            Mark Module Complete
          </button>
          <p class="hint" id="detailHint"></p>
        </div>
      </section>

      <!-- SETTINGS VIEW -->
      <section id="view-settings" class="view">
        <div class="card">
          <h2>Settings</h2>
          <div class="settings-group">
            <div class="settings-item" id="profileFirstNameRow">
              <span>First Name</span>
              <span class="muted" id="profileFirstNameValue" style="font-size:0.8rem;">Fname</span>
            </div>
            <div class="settings-item" id="profileLastNameRow">
              <span>Last Name</span>
              <span class="muted" id="profileLastNameValue" style="font-size:0.8rem;">Lname</span>
            </div>
            <div class="settings-item" id="profileCommonNameRow">
              <span>Common Name</span>
              <span class="muted" id="profileCommonNameValue" style="font-size:0.8rem;">Optional</span>
            </div>
            <div class="settings-item no-click">
              <span>Location</span>
              <select id="profileLocationSelect" class="settings-select">
                <option value="Kyle">Kyle</option>
                <option value="Other">Other...</option>
              </select>
            </div>
            <div class="settings-item" id="profileEmployeeIdRow">
              <span>Employee ID</span>
              <span class="muted" id="profileEmployeeIdValue" style="font-size:0.8rem;">Not set</span>
            </div>
            <div class="settings-item no-click">
              <span>Dark Mode</span>
              <div id="darkToggle" class="toggle">
                <div class="toggle-thumb"></div>
              </div>
            </div>
            <div class="settings-item no-click">
              <span>Notifications</span>
              <span class="muted" style="font-size:0.8rem;">Coming later</span>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>Style Guide</h3>
          <p class="muted" style="font-size:0.8rem;">
            Choose a preset accent theme. These colors are used for highlights and primary actions. Swapping accents flips primary and secondary.
          </p>

          <div class="preset-grid" id="presetGrid"></div>

          <div class="style-row-toggle">
            <span>Swap accents (primary ⇄ secondary)</span>
            <div id="swapToggle" class="toggle">
              <div class="toggle-thumb"></div>
            </div>
          </div>

          <div class="theme-preview" id="stylePreview">
            <div class="theme-preview-swatch" id="stylePreviewSwatch">
              <div class="theme-preview-labels">
                <div id="stylePreviewTitle">Preview: Button & Card</div>
                <div id="stylePreviewSubtitle">Accent pair</div>
              </div>
              <button class="theme-preview-button" id="stylePreviewButton" type="button">
                Sample Action
              </button>
            </div>
          </div>

          <p class="style-guide-note">
            Tap <strong>Save Theme</strong> to apply your selection across the app. Dark Mode still stacks on top of your theme.
          </p>

          <button class="btn btn-primary" id="saveThemeBtn">
            Save Theme
          </button>
        </div>
      </section>

      <!-- ASSIGNED MODULES VIEW -->
      <section id="view-assigned" class="view">
        <div class="card">
          <h2>Assigned Modules</h2>
          <p class="muted" style="font-size:0.8rem;">
            All training modules are required.
          </p>
          <div class="divider"></div>
          <div id="assignedList"></div>
        </div>
      </section>
    </main>

    <footer>
      <div class="tabbar">
        <button class="tab-btn active" data-tab="home">
          <span>Home</span>
          <span class="dot"></span>
        </button>
        <button class="tab-btn" data-tab="modules">
          <span>Modules</span>
          <span class="dot"></span>
        </button>
      </div>
    </footer>

    <div id="toast" class="toast"></div>
  </div>

  <script>
    // ---------- Theme Presets -----------------------------------------------
    const THEME_PRESETS = [
      { id: "house_default", name: "House Default", primary: "#f97316", secondary: "#facc15" },

      { id: "white_black", name: "White / Black", primary: "#ffffff", secondary: "#000000" },
      { id: "white_blue", name: "White / Blue", primary: "#ffffff", secondary: "#003594" },
      { id: "white_red", name: "White / Red", primary: "#ffffff", secondary: "#d11111" },
      { id: "white_green", name: "White / Green", primary: "#ffffff", secondary: "#15803d" },
      { id: "white_purple", name: "White / Purple", primary: "#ffffff", secondary: "#6d28d9" },
      { id: "white_cyan", name: "White / Cyan", primary: "#ffffff", secondary: "#0891b2" },
      { id: "white_yellow", name: "White / Yellow", primary: "#ffffff", secondary: "#eab308" },

      { id: "black_white", name: "Black / White", primary: "#000000", secondary: "#ffffff" },
      { id: "black_blue", name: "Black / Blue", primary: "#000000", secondary: "#003594" },
      { id: "black_red", name: "Black / Red", primary: "#000000", secondary: "#d11111" },
      { id: "black_green", name: "Black / Green", primary: "#000000", secondary: "#15803d" },
      { id: "black_purple", name: "Black / Purple", primary: "#000000", secondary: "#6d28d9" },
      { id: "black_cyan", name: "Black / Cyan", primary: "#000000", secondary: "#0891b2" },
      { id: "black_yellow", name: "Black / Yellow", primary: "#000000", secondary: "#eab308" },

      { id: "purple_yellow", name: "Purple / Yellow", primary: "#6d28d9", secondary: "#eab308" },
      { id: "green_red", name: "Green / Red", primary: "#15803d", secondary: "#d11111" },
      { id: "cyan_blue", name: "Cyan / Blue", primary: "#0891b2", secondary: "#003594" }
    ];

    function hexToRgb(hex) {
      const clean = hex.replace("#", "");
      if (clean.length !== 6) return { r: 0, g: 0, b: 0 };
      const r = parseInt(clean.slice(0, 2), 16);
      const g = parseInt(clean.slice(2, 4), 16);
      const b = parseInt(clean.slice(4, 6), 16);
      return { r, g, b };
    }

    function hexToRgba(hex, alpha) {
      const { r, g, b } = hexToRgb(hex);
      return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

    function pickTextColorForBackground(hex) {
      const { r, g, b } = hexToRgb(hex);
      const brightness = (r * 299 + g * 587 + b * 114) / 1000;
      return brightness > 150 ? "#000000" : "#ffffff";
    }

    // ---------- Modules -----------------------------------------------------
    const MODULES = [
      {
        id: "prep_ice_cream_balls",
        title: "Prep — Ice Cream Balls",
        category: "Prep",
        description:
          "Prepare and restock Ice Cream Balls during prep so servers can plate desserts quickly.",
        steps: [
          "Verify you have ice cream, corn flakes, and storage containers.",
          "Scoop six ice cream balls on weekdays, eight on Fri/Sat.",
          "Roll each scoop in corn flakes until coated.",
          "Place balls onto tray or into container for freezing.",
          "Label and store the tray in the correct freezer."
        ]
      },
      {
        id: "prep_tortilla_trays",
        title: "Prep — Tortilla Trays",
        category: "Prep",
        imageUrl: "https://prometheangamescom.wordpress.com/wp-content/uploads/2025/11/screenshot-2025-11-24-141147.png",
        description:
          "Press and stage tortillas so the line never runs out during service.",
        steps: [
          "Gather tortilla dough balls and clean trays.",
          "Press dough balls into flat tortillas.",
          "Stack tortillas neatly on trays.",
          "Cover trays to prevent drying out.",
          "Store in the correct cooler or staging area."
        ]
      },
      {
        id: "prep_polish_utensils",
        title: "Prep — Polish Utensils",
        category: "Prep",
        description:
          "Polish and stage utensils so servers can roll silverware quickly.",
        steps: [
          "Gather clean, dry utensils.",
          "Use a dry polishing towel to remove any water spots.",
          "Sort utensils into the correct containers.",
          "Restock the Expo station with polished utensils."
        ]
      },
      {
        id: "prep_make_sauces",
        title: "Prep — Make Sauces",
        category: "Prep",
        description:
          "Batch and label sauces needed on the line: creamy cilantro, chipotle, ranch, and others.",
        steps: [
          "Review par sheet for each sauce.",
          "Measure ingredients according to the recipe.",
          "Whisk or blend until smooth.",
          "Transfer to labeled containers.",
          "Store in the correct cooler or line well."
        ]
      },
      {
        id: "sauces_overview",
        title: "Sauces Overview",
        category: "Sauces",
        description:
          "Know which sauces pair with which dishes and where they are stored.",
        steps: [
          "Review each house sauce and its primary dishes.",
          "Locate each sauce on the line and in backup storage.",
          "Check labels and dates before service.",
          "Spot-check temperatures if required by policy."
        ]
      },
      {
        id: "closing_duties_basic",
        title: "Closing Duties — Expo Line",
        category: "Closing Duties",
        description:
          "Clean and reset the Expo line so the next shift starts ready to go.",
        steps: [
          "Clear and consolidate pans and containers.",
          "Wipe and sanitize surfaces and heat lamps.",
          "Wrap or label any items being saved.",
          "Break down and clean the window and ledges.",
          "Take out trash following store procedure."
        ]
      },
      {
        id: "closing_light_close",
        title: "Closing Duties — Light Close",
        category: "Closing Duties",
        description:
          "Perform essential end-of-shift tasks to reset the Expo and tortilla preparation areas for the following day.",
        steps: [
          "Sweep the Expo and tortilla prep area and store all four black floor mats in their designated location.",
          "Turn off both side warmers to allow safe cool-down.",
          "Wipe down and sanitize the Expo window, ledges, and line surfaces.",
          "Tear down the tortilla machine following the full tortilla-machine module procedure.",
          "Polish and restock utensils as needed for the next shift.",
          "Check Ice Cream Ball inventory and prep additional batches if below par.",
          "Check tortilla tray inventory and press additional trays if needed."
        ]
      },
      {
        id: "closing_tortilla_machine",
        title: "Closing Duties — Tortilla Machine",
        category: "Closing Duties",
        imageUrl: "https://prometheangamescom.wordpress.com/wp-content/uploads/2025/11/closing-duties_tortilla-machine.jpg",
        description:
          "Shut down, clean, and reset the tortilla machine so it’s safe, sanitary, and ready for the next shift.",
        steps: [
          "Power down the tortilla machine following standard shut-off protocol.",
          "Carefully remove the black knob once surfaces have cooled enough to handle.",
          "Remove the faceplate and wash it thoroughly in the dish area.",
          "Disengage and remove the locking pin with heat awareness.",
          "Lift and remove the steel tortilla ramp, placing it in the dish area for cleaning.",
          "Wipe down all accessible surfaces, focusing on flour buildup and heat-retaining areas.",
          "Cover the flour bin with foil to maintain sanitation standards overnight.",
          "Store any remaining tortillas in the appropriate cooler container.",
          "Vacuum hard-to-reach areas to remove flour dust and debris."
        ]
      }
    ];

    // ---------- State & Profile ---------------------------------------------
    const STORAGE_KEY = "expoTrainingMvpState_v9";
    const PROFILE_NAME_KEY = "expoTrainingName"; // legacy fallback
    const PROFILE_FIRST_NAME_KEY = "expoTrainingFirstName";
    const PROFILE_LAST_NAME_KEY = "expoTrainingLastName";
    const PROFILE_COMMON_NAME_KEY = "expoTrainingCommonName";
    const PROFILE_LOCATION_KEY = "expoTrainingLocation";
    const PROFILE_EMPLOYEE_ID_KEY = "expoTrainingEmployeeId";
    const CLIENT_ID_KEY = "expoTrainingClientId";

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw)
          return {
            completed: {},
            dark: false,
            primaryColor: "#f97316",
            secondaryColor: "#facc15",
            selectedThemeId: "house_default",
            swapAccents: false
          };
        const parsed = JSON.parse(raw);
        return {
          completed: parsed.completed || {},
          dark: typeof parsed.dark === "boolean" ? parsed.dark : false,
          primaryColor: parsed.primaryColor || "#f97316",
          secondaryColor: parsed.secondaryColor || "#facc15",
          selectedThemeId: parsed.selectedThemeId || "house_default",
          swapAccents: !!parsed.swapAccents
        };
      } catch {
        return {
          completed: {},
          dark: false,
          primaryColor: "#f97316",
          secondaryColor: "#facc15",
          selectedThemeId: "house_default",
          swapAccents: false
        };
      }
    }

    let state = loadState();

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function getClientId() {
      let id = localStorage.getItem(CLIENT_ID_KEY);
      if (!id) {
        id = "client_" + Math.random().toString(36).slice(2);
        localStorage.setItem(CLIENT_ID_KEY, id);
      }
      return id;
    }

    function getProfile() {
      const firstName = localStorage.getItem(PROFILE_FIRST_NAME_KEY) || "";
      const lastName = localStorage.getItem(PROFILE_LAST_NAME_KEY) || "";
      const commonName = localStorage.getItem(PROFILE_COMMON_NAME_KEY) || "";

      const legacyFull =
        localStorage.getItem(PROFILE_NAME_KEY) || "Fname Lname";

      let legalName = (firstName + " " + lastName).trim();
      if (!legalName) {
        legalName = legacyFull;
      }

      let displayName = legalName;
      if (commonName && commonName.trim()) {
        displayName = commonName.trim();
      }

      const location =
        localStorage.getItem(PROFILE_LOCATION_KEY) || "Kyle";
      const employee_id =
        localStorage.getItem(PROFILE_EMPLOYEE_ID_KEY) || "";
      const role = "Expo";

      return {
        firstName,
        lastName,
        commonName,
        legalName,
        displayName,
        employee_name: legalName,
        location,
        employee_id,
        role,
        client_id: getClientId()
      };
    }

    function refreshHeaderFromProfile() {
      const profile = getProfile();
      headerSub.textContent = profile.displayName;
    }

    function updateSettingsProfileUI() {
      const profile = getProfile();
      document.getElementById("profileFirstNameValue").textContent =
        profile.firstName || "Fname";
      document.getElementById("profileLastNameValue").textContent =
        profile.lastName || "Lname";
      document.getElementById("profileCommonNameValue").textContent =
        profile.commonName || "Optional";
      document.getElementById("profileEmployeeIdValue").textContent =
        profile.employee_id || "Not set";

      const locationSelect = document.getElementById("profileLocationSelect");
      locationSelect.value = profile.location === "Other" ? "Other" : "Kyle";
    }

    // ---------- Backend sync (Google Sheets) --------------------------------
    const SHEETS_ENDPOINT =
      "https://script.google.com/macros/s/AKfycbykPwcIulm6Tjo8JynUyviawqEDAQA7fqBMIN9I8jukZ9PrzYVO4dECESbh2GnEy9QyCw/exec";

    function syncCompletionToSheet(module, completionPct) {
      const profile = getProfile();

      const payload = {
        timestamp: new Date().toISOString(),
        employee_name: profile.employee_name,
        display_name: profile.displayName,
        employee_id: profile.employee_id,
        location: profile.location,
        role: profile.role,
        module_id: module.id,
        module_title: module.title,
        event_type: "MODULE_COMPLETED",
        completion_pct: completionPct,
        client_id: profile.client_id
      };

      fetch(SHEETS_ENDPOINT, {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      }).catch((err) => {
        console.error("Sync to Sheets failed:", err);
      });
    }

    // ---------- Toast -------------------------------------------------------
    const toastEl = document.getElementById("toast");
    let toastTimeoutId = null;

    function showToast(message) {
      toastEl.textContent = message;
      toastEl.classList.add("show");
      if (toastTimeoutId) {
        clearTimeout(toastTimeoutId);
      }
      toastTimeoutId = setTimeout(() => {
        toastEl.classList.remove("show");
      }, 3200);
    }

    // ---------- Views & Nav -------------------------------------------------
    const views = {
      home: document.getElementById("view-home"),
      modules: document.getElementById("view-modules"),
      moduleDetail: document.getElementById("view-module-detail"),
      settings: document.getElementById("view-settings"),
      assigned: document.getElementById("view-assigned")
    };

    const headerTitle = document.getElementById("headerTitle");
    const headerSub = document.getElementById("headerSub");
    const backButton = document.getElementById("backButton");

    let currentView = "home";
    let lastView = "home";

    function updateBackButton() {
      if (
        currentView === "settings" ||
        currentView === "assigned" ||
        currentView === "moduleDetail"
      ) {
        backButton.style.display = "inline-flex";
      } else {
        backButton.style.display = "none";
      }
    }

    function setView(viewKey, viaBack = false) {
      if (!viaBack && viewKey !== currentView) {
        lastView = currentView;
      }
      currentView = viewKey;
      Object.values(views).forEach((v) => v.classList.remove("active"));
      const view = views[viewKey];
      if (view) view.classList.add("active");

      if (viewKey === "home") headerTitle.textContent = "Home";
      else if (viewKey === "modules") headerTitle.textContent = "Modules";
      else if (viewKey === "moduleDetail") headerTitle.textContent = "Module Detail";
      else if (viewKey === "settings") headerTitle.textContent = "Settings";
      else if (viewKey === "assigned") headerTitle.textContent = "Assigned Modules";

      document
        .querySelectorAll(".tab-btn")
        .forEach((btn) => btn.classList.remove("active"));

      if (viewKey === "home") {
        document
          .querySelector('.tab-btn[data-tab="home"]')
          .classList.add("active");
      } else if (viewKey === "modules" || viewKey === "moduleDetail") {
        document
          .querySelector('.tab-btn[data-tab="modules"]')
          .classList.add("active");
      }

      updateBackButton();
    }

    backButton.addEventListener("click", () => {
      const target = lastView || "home";
      setView(target, true);
      if (target === "home") {
        renderHome();
      } else if (target === "modules") {
        renderModulesList();
      } else if (target === "assigned") {
        renderAssignedView();
      }
    });

    // ---------- Home & Modules Rendering -----------------------------------
    function getAssignedModules() {
      return MODULES;
    }

    function getCompletedAssignedCount() {
      const assigned = getAssignedModules();
      return assigned.filter((m) => !!state.completed[m.id]).length;
    }

    function renderHome() {
      const assigned = getAssignedModules();
      const completedCount = getCompletedAssignedCount();

      const label = document.getElementById("progressLabel");
      label.textContent = `${completedCount} / ${assigned.length} Modules Completed`;

      const progressFill = document.getElementById("progressFill");
      const pct =
        assigned.length === 0 ? 0 : (completedCount / assigned.length) * 100;
      progressFill.style.width = pct + "%";

      const alertContainer = document.getElementById("homeAlertContainer");
      alertContainer.innerHTML = "";
      const alert = document.createElement("div");
      alert.className = "alert";
      if (assigned.length === 0) {
        alert.innerHTML =
          "<div><strong>No training modules yet.</strong><span class='muted'>Your training plan has not been configured.</span></div>";
      } else if (completedCount < assigned.length) {
        const remaining = assigned.length - completedCount;
        alert.innerHTML = `<div><strong>Training in progress.</strong>You have ${remaining} required module${
          remaining !== 1 ? "s" : ""
        } left to complete.</div>`;
      } else {
        alert.classList.add("complete");
        alert.innerHTML =
          "<div><strong>You have completed all required training.</strong><span class='muted'>Great job. Check back for new modules.</span></div>";
      }
      alertContainer.appendChild(alert);

      const homeList = document.getElementById("homeModuleList");
      homeList.innerHTML = "";
      MODULES.slice(0, 3).forEach((m) => {
        const completed = !!state.completed[m.id];
        const item = document.createElement("div");
        item.className =
          "list-item " + (completed ? "status-complete" : "status-required");
        item.onclick = () => openModuleDetail(m.id);
        const meta = completed ? "Complete" : "Required";
        item.innerHTML = `<span class="label">${m.title}</span><span class="meta">${meta}</span>`;
        homeList.appendChild(item);
      });

      const homeAssigned = document.getElementById("homeAssignedList");
      homeAssigned.innerHTML = "";
      if (assigned.length === 0) {
        const empty = document.createElement("div");
        empty.className = "empty-state";
        empty.textContent = "No training modules configured.";
        homeAssigned.appendChild(empty);
      } else {
        assigned.forEach((m) => {
          const completed = !!state.completed[m.id];
          const item = document.createElement("div");
          item.className =
            "list-item " + (completed ? "status-complete" : "status-required");
          item.onclick = () => openModuleDetail(m.id);
          const meta = completed ? "Complete" : "Required";
          item.innerHTML = `<span class="label">${m.title}</span><span class="meta">${meta}</span>`;
          homeAssigned.appendChild(item);
        });
      }
    }

    function renderModulesList() {
      const container = document.getElementById("modulesList");
      container.innerHTML = "";

      const categories = {};
      MODULES.forEach((m) => {
        if (!categories[m.category]) categories[m.category] = [];
        categories[m.category].push(m);
      });

      Object.keys(categories)
        .sort()
        .forEach((cat) => {
          const catTitle = document.createElement("h3");
          catTitle.textContent = cat;
          catTitle.style.marginTop = "0.4rem";
          catTitle.style.marginBottom = "0.25rem";
          container.appendChild(catTitle);

          const list = document.createElement("div");
          list.className = "list";

          categories[cat].forEach((m) => {
            const completed = !!state.completed[m.id];
            const item = document.createElement("div");
            item.className =
              "list-item " + (completed ? "status-complete" : "status-required");
            item.onclick = () => openModuleDetail(m.id);
            const meta = completed ? "Complete" : "Required";
            item.innerHTML = `<span class="label">${m.title}</span><span class="meta">${meta}</span>`;
            list.appendChild(item);
          });

          container.appendChild(list);
        });
    }

    // ---------- Module Detail & Completion Gating ---------------------------
    let currentModuleId = null;

    function updateCompleteButtonState() {
      const btn = document.getElementById("completeModuleBtn");
      btn.classList.remove("completed");
      if (!currentModuleId) {
        btn.disabled = true;
        return;
      }

      const completedAlready = !!state.completed[currentModuleId];
      if (completedAlready) {
        btn.disabled = true;
        btn.textContent = "Module Completed";
        btn.classList.add("completed");
        return;
      }

      const checkboxes = document.querySelectorAll(
        "#detailSteps input[type='checkbox']"
      );
      if (checkboxes.length === 0) {
        btn.disabled = true;
        btn.textContent = "Mark Module Complete";
        return;
      }

      const allChecked = Array.from(checkboxes).every((cb) => cb.checked);
      btn.disabled = !allChecked;
      btn.textContent = allChecked
        ? "Mark Module Complete"
        : "Check all steps to complete";
    }

    function openModuleDetail(id) {
      const module = MODULES.find((m) => m.id === id);
      if (!module) return;

      currentModuleId = id;
      document.getElementById("detailCategoryPill").textContent =
        module.category;
      document.getElementById("detailTitle").textContent = module.title;
      document.getElementById("detailDescription").textContent =
        module.description;

      const imgContainer = document.getElementById("detailImageContainer");
      imgContainer.innerHTML = "";
      const wrapper = document.createElement("div");
      wrapper.className = "module-image-wrapper";

      if (module.imageUrl) {
        const img = document.createElement("img");
        img.src = module.imageUrl;
        img.alt = module.title;
        wrapper.appendChild(img);
      } else {
        const placeholder = document.createElement("div");
        placeholder.className = "module-image-placeholder";
        placeholder.textContent = "Training image coming soon.";
        wrapper.appendChild(placeholder);
      }

      imgContainer.appendChild(wrapper);

      const stepsContainer = document.getElementById("detailSteps");
      stepsContainer.innerHTML = "";
      module.steps.forEach((step, index) => {
        const row = document.createElement("div");
        row.className = "step-row";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.dataset.stepIndex = index;
        checkbox.addEventListener("change", updateCompleteButtonState);

        const label = document.createElement("label");
        label.textContent = step;

        row.appendChild(checkbox);
        row.appendChild(label);
        stepsContainer.appendChild(row);
      });

      const completed = !!state.completed[id];
      const hint = document.getElementById("detailHint");
      hint.textContent = completed
        ? "This module is marked complete. You can review steps any time."
        : "Work through each step, then check all boxes to enable completion.";

      const btn = document.getElementById("completeModuleBtn");
      btn.disabled = true;
      btn.classList.remove("completed");
      if (completed) {
        btn.disabled = true;
        btn.textContent = "Module Completed";
        btn.classList.add("completed");
      } else {
        btn.textContent = "Check all steps to complete";
      }

      updateCompleteButtonState();
      setView("moduleDetail");
    }

    document
      .getElementById("completeModuleBtn")
      .addEventListener("click", () => {
        if (!currentModuleId) return;
        const btn = document.getElementById("completeModuleBtn");
        if (btn.disabled) return;

        const module = MODULES.find((m) => m.id === currentModuleId);
        if (!module) return;

        state.completed[currentModuleId] = true;
        saveState();

        renderHome();
        renderModulesList();

        const assigned = getAssignedModules();
        const completedCount = getCompletedAssignedCount();
        const pct =
          assigned.length === 0
            ? 0
            : Math.round((completedCount / assigned.length) * 100);

        syncCompletionToSheet(module, pct);

        btn.classList.add("completed");
        btn.textContent = "Module Completed";
        btn.disabled = true;

        setView("home");
        showToast(
          `Completed: ${module.title} • ${pct}% of required training done`
        );
      });

    // ---------- Assigned View -----------------------------------------------
    function renderAssignedView() {
      const container = document.getElementById("assignedList");
      container.innerHTML = "";
      const assigned = getAssignedModules();
      if (assigned.length === 0) {
        const empty = document.createElement("div");
        empty.className = "empty-state";
        empty.textContent = "No training modules configured.";
        container.appendChild(empty);
      } else {
        const list = document.createElement("div");
        list.className = "list";
        assigned.forEach((m) => {
          const completed = !!state.completed[m.id];
          const item = document.createElement("div");
          item.className =
            "list-item " + (completed ? "status-complete" : "status-required");
          item.onclick = () => openModuleDetail(m.id);
          const meta = completed ? "Complete" : "Required";
          item.innerHTML = `<span class="label">${m.title}</span><span class="meta">${meta}</span>`;
          list.appendChild(item);
        });
        container.appendChild(list);
      }
    }

    // ---------- Dark Mode & Accent Theme -----------------------------------
    const darkToggle = document.getElementById("darkToggle");

    function getEffectiveAccentPair() {
      let primary = state.primaryColor || "#f97316";
      let secondary = state.secondaryColor || "#facc15";
      if (state.swapAccents) {
        const tmp = primary;
        primary = secondary;
        secondary = tmp;
      }
      return { primary, secondary };
    }

    function applyAccentTheme() {
      const { primary, secondary } = getEffectiveAccentPair();
      const rootStyle = document.documentElement.style;

      rootStyle.setProperty("--accentA", primary);
      rootStyle.setProperty("--accentB", secondary);
      rootStyle.setProperty("--accent", primary);
      rootStyle.setProperty("--accent-soft", hexToRgba(primary, 0.12));

      // For light mode, also tint backgrounds and borders
      if (!state.dark) {
        rootStyle.setProperty("--bg", hexToRgba(primary, 0.03));
        rootStyle.setProperty("--bg-elevated", "#ffffff");
        rootStyle.setProperty("--bg-soft", hexToRgba(primary, 0.08));
        rootStyle.setProperty("--border", hexToRgba(primary, 0.25));
      }
      // In dark mode, bg vars come from body.dark; accent still updates.
    }

    function applyDarkMode() {
      if (state.dark) {
        document.body.classList.add("dark");
        darkToggle.classList.add("on");
      } else {
        document.body.classList.remove("dark");
        darkToggle.classList.remove("on");
      }
    }

    darkToggle.addEventListener("click", () => {
      state.dark = !state.dark;
      saveState();
      applyDarkMode();
      // Re-apply theme so any light-mode BG tint is recalculated when toggling back
      applyAccentTheme();
    });

    // ---------- Style Guide Controls ----------------------------------------
    const presetGrid = document.getElementById("presetGrid");
    const swapToggle = document.getElementById("swapToggle");
    const previewSwatch = document.getElementById("stylePreviewSwatch");
    const previewButton = document.getElementById("stylePreviewButton");
    const previewTitle = document.getElementById("stylePreviewTitle");
    const previewSubtitle = document.getElementById("stylePreviewSubtitle");
    const saveThemeBtn = document.getElementById("saveThemeBtn");

    function renderPresetGrid() {
      presetGrid.innerHTML = "";
      THEME_PRESETS.forEach((preset) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "preset-btn";
        btn.dataset.presetId = preset.id;

        if (preset.id === state.selectedThemeId) {
          btn.classList.add("active");
        }

        const name = document.createElement("div");
        name.className = "preset-name";
        name.textContent = preset.name;

        const swatch = document.createElement("div");
        swatch.className = "preset-swatch";

        const left = document.createElement("span");
        left.style.background = preset.primary;

        const right = document.createElement("span");
        right.style.background = preset.secondary;

        swatch.appendChild(left);
        swatch.appendChild(right);

        btn.appendChild(name);
        btn.appendChild(swatch);

        btn.addEventListener("click", () => {
          state.selectedThemeId = preset.id;
          state.primaryColor = preset.primary;
          state.secondaryColor = preset.secondary;
          saveState();
          highlightActivePreset();
          renderStylePreviewWithState();
        });

        presetGrid.appendChild(btn);
      });
    }

    function highlightActivePreset() {
      const buttons = presetGrid.querySelectorAll(".preset-btn");
      buttons.forEach((btn) => {
        if (btn.dataset.presetId === state.selectedThemeId) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });
    }

    function renderStylePreview(primary, secondary) {
      const textColor = pickTextColorForBackground(primary);
      previewSwatch.style.background = primary;
      previewSwatch.style.color = textColor;
      previewSwatch.style.borderColor = hexToRgba(textColor, 0.1);

      previewButton.style.backgroundImage = `linear-gradient(135deg, ${primary}, ${secondary})`;
      previewButton.style.color = pickTextColorForBackground(secondary);
      previewTitle.textContent = "Preview: Button & Card";
      previewSubtitle.textContent = `Primary: ${primary} • Secondary: ${secondary}`;
    }

    function renderStylePreviewWithState() {
      const { primary, secondary } = getEffectiveAccentPair();
      renderStylePreview(primary, secondary);
      if (state.swapAccents) {
        previewSubtitle.textContent += " • Swapped";
      }
      if (state.selectedThemeId === "house_default") {
        previewSubtitle.textContent += " • House Default";
      }
    }

    function initStyleGuideControls() {
      renderPresetGrid();
      highlightActivePreset();

      if (state.swapAccents) {
        swapToggle.classList.add("on");
      } else {
        swapToggle.classList.remove("on");
      }

      renderStylePreviewWithState();
    }

    swapToggle.addEventListener("click", () => {
      state.swapAccents = !state.swapAccents;
      saveState();
      if (state.swapAccents) {
        swapToggle.classList.add("on");
      } else {
        swapToggle.classList.remove("on");
      }
      renderStylePreviewWithState();
    });

    saveThemeBtn.addEventListener("click", () => {
      applyAccentTheme();
      renderHome();
      renderModulesList();

      const activePreset =
        THEME_PRESETS.find((p) => p.id === state.selectedThemeId) || null;
      const label = activePreset ? activePreset.name : "Custom Theme";
      showToast(`Theme updated — ${label}`);
      saveState();
    });

    // ---------- Settings: Profile Editing -----------------------------------
    document
      .getElementById("profileFirstNameRow")
      .addEventListener("click", () => {
        const current = getProfile().firstName;
        const value = prompt("Enter your first name", current || "");
        if (value && value.trim()) {
          localStorage.setItem(PROFILE_FIRST_NAME_KEY, value.trim());
          refreshHeaderFromProfile();
          updateSettingsProfileUI();
        }
      });

    document
      .getElementById("profileLastNameRow")
      .addEventListener("click", () => {
        const current = getProfile().lastName;
        const value = prompt("Enter your last name", current || "");
        if (value && value.trim()) {
          localStorage.setItem(PROFILE_LAST_NAME_KEY, value.trim());
          refreshHeaderFromProfile();
          updateSettingsProfileUI();
        }
      });

    document
      .getElementById("profileCommonNameRow")
      .addEventListener("click", () => {
        const current = getProfile().commonName;
        const value = prompt(
          "Enter your common name (optional)",
          current || ""
        );
        if (value !== null) {
          localStorage.setItem(PROFILE_COMMON_NAME_KEY, value.trim());
          refreshHeaderFromProfile();
          updateSettingsProfileUI();
        }
      });

    document
      .getElementById("profileEmployeeIdRow")
      .addEventListener("click", () => {
        const current = getProfile().employee_id;
        const value = prompt(
          "Enter your employee ID (optional)",
          current || ""
        );
        if (value !== null) {
          localStorage.setItem(PROFILE_EMPLOYEE_ID_KEY, value.trim());
          updateSettingsProfileUI();
        }
      });

    document
      .getElementById("profileLocationSelect")
      .addEventListener("change", (e) => {
        const value = e.target.value === "Other" ? "Other" : "Kyle";
        localStorage.setItem(PROFILE_LOCATION_KEY, value);
        updateSettingsProfileUI();
      });

    // ---------- Navigation Wiring -------------------------------------------
    document
      .querySelectorAll(".tab-btn")
      .forEach((btn) =>
        btn.addEventListener("click", () => {
          const tab = btn.dataset.tab;
          if (tab === "home") {
            setView("home");
            renderHome();
          } else if (tab === "modules") {
            setView("modules");
            renderModulesList();
          }
        })
      );

    document
      .getElementById("settingsButton")
      .addEventListener("click", () => {
        updateSettingsProfileUI();
        initStyleGuideControls();
        setView("settings");
      });

    document.getElementById("goToModulesBtn").addEventListener("click", () => {
      setView("modules");
      renderModulesList();
    });

    headerSub.addEventListener("click", () => {
      renderAssignedView();
      setView("assigned");
    });

    // ---------- Initial Render ----------------------------------------------
    applyDarkMode();
    applyAccentTheme();
    refreshHeaderFromProfile();
    updateSettingsProfileUI();
    initStyleGuideControls();
    renderHome();
    renderModulesList();
  </script>
</body>
</html>
